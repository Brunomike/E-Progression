<%- include('../partials/header.ejs') %> 
<div class="container-fluid px-4"> 
<br>
<nav>
    <ol class="breadcrumb">
      <li class="breadcrumb-item" style="cursor:pointer;"><a href="/admin/user-management">User Manamagent</a></li>
      <li class="breadcrumb-item" style="cursor:pointer;"><a href="/user/view/<%=user.uuid %> ">View User</a></li>
      <li class="breadcrumb-item " aria-current="page">Edit User</li>          
    </ol>
  </nav>

  <div class="row">    
    <div class="col-xl-4">
        <!-- Profile picture card-->
        <div class="card mb-4 mb-xl-0">
            <div class="card-header">Profile Picture</div>
            <div class="card-body text-center">                              
                <% if(user.user_profile_image_link==null) {%> 
                    <% if(user.user_gender=="Male") {%> 
                <!-- Profile picture image-->
                <img class="img-account-profile rounded-circle mb-1" src="/assets/img/profile_male.svg" alt="Profile Picture" width="140px" height="140px">
                <% } else{ %>
                    <img class="img-account-profile rounded-circle mb-1" src="/assets/img/profile_female.svg" alt="Profile Picture" width="140px" height="140px">
                <% } %> 
                <!-- Profile picture message if none exist--> 
                    <div class="small font-italic text-muted mb-4">
                        No profile image link found!
                        Edit User to Upload a profile image(.png).
                    </div>
                <% } else{ %>
                    <img class="img-account-profile rounded-circle mb-1" src="<%= user.user_profile_image_link%> " alt="Profile Picture" width="140px" height="140px">
                    <div class="small font-italic text-muted mb-4">
                        Upload new profile picture(.png)
                    </div>
                <% } %> 

            </div>
            
        </div>
        <br>
        <div class="card mb-4 mb-xl-0" style="background:transparent;">
            <form action="/user/upload-profile-image/<%=user.uuid%> " method="post" enctype="multipart/form-data" >   
                <div class="mb-3">     
                  <input type="hidden" name="_csrf" id="_csrf" value="<%= csrfToken %>">
                  <input type="hidden" name="userUUID" id="userUUID" value="<%= user.uuid %> ">
                  <input type="hidden" name="photoURL" id="photoURL" >
                  <input type="file"  class="form-control"  name="selectedImage" id="selectedImage">
                </div>   
                <p class="h6" id="uploadStatus" style="display: none">Loading...</p>
                <button type="submit" id="uploadImage" class="btn btn-primary">Upload Image</button>
              </form> 
            
        </div>

        
        
    </div>
    <div class="col-xl-8">
        <!-- Account details card-->
        <div class="card mb-4">
            <div class="card-header"><%= user.first_name %>'s Account Details</div>
            <div class="card-body">
                <form action="/user/edit/<%= user.uuid %>" method="post">     
                    <style type="text/css">
                        input[name=first_name] {
                          pointer-events: none;
                         }
                        input[name=last_name] {
                          pointer-events: none;
                         }
                        input[name=user_gender] {
                          pointer-events: none;
                         }
                        input[name=email_address] {
                          pointer-events: none;
                         }
                       </style>                                 
                    <!-- Form Row-->
                    <div class="row gx-3 mb-3">
                        <!-- Form Group (first name)-->
                        <div class="col-md-6">
                            <label class="small mb-1" for="inputFirstName">First name</label>
                            <input class="form-control" id="inputFirstName" name="first_name" type="text" placeholder="Enter your first name" value="<%=user.first_name%>"/>
                        </div>
                        <!-- Form Group (last name)-->
                        <div class="col-md-6">
                            <label class="small mb-1" for="inputLastName">Last name</label>
                            <input class="form-control" id="inputLastName" name="last_name" type="text" placeholder="Enter your last name" value="<%=user.last_name%>">
                        </div>
                    </div>
                    <!-- Form Row        -->
                    <div class="row gx-3 mb-3">
                        <!-- Form Group (other name)-->
                        <div class="col-md-6">
                            <label class="small mb-1" for="inputOrgName">Other name(s)</label>
                            <input class="form-control" id="inputOrgName" name="other_names" type="text"  value="<%=user.other_names%>">
                        </div>
                        <!-- Form Group (location)-->
                        <div class="col-md-6">
                            <label class="small mb-1" for="inputLocation">Gender</label>
                            <input class="form-control" id="userGender" name="user_gender" type="text" placeholder="Enter your location" value="<%= user.user_gender %> ">
                        </div>
                    </div>
                    <!-- Form Row        -->
                    <div class="row gx-3 mb-3">
                        <!-- Form Group (user status)-->
                        <div class="col-md-6">
                            <!-- <label class="small mb-1" for="inputOrgName">User Status</label>
                            <input class="form-control" id="inputOrgName" type="text" name="user_status"  value="<%=user.user_status%>"> -->
                            <!-- <div class="form-floating" > -->
                                <label class="small mb-1" for="floatingSelect">User Status</label>
                                <select class="form-select"  id="floatingSelect" aria-label="Floating label select example" name="user_status">
                                  <option selected><%=user.user_status%></option>
                                  <option value="active">active </option>
                                  <option value="disabled">disabled</option>
                                </select>
                              <!-- </div> -->
                        </div>
                        <!-- Form Group (user role)-->
                        <div class="col-md-6">
                            <!-- <label class="small mb-1" for="inputLocation">User Role</label>
                            <input class="form-control" id="userRole" name="user_role" type="text" placeholder="Enter your location" value="<%= user.user_role %> "> -->
                            <label class="small mb-1" for="floatingSelect">User Status</label>
                                <select class="form-select"  id="floatingSelect" aria-label="Floating label select example" name="user_role">
                                  <option selected><%=user.user_role%></option>
                                  <option value="active">admin </option>
                                  <option value="disabled">parent</option>
                                </select>
                        </div>
                    </div>
                      <!-- Form Group (email address)-->
                      <div class="mb-3">
                        <label class="small mb-1" for="inputEmailAddress">Email address</label>
                        <input class="form-control" id="inputEmailAddress" name="email_address" type="email" placeholder="Enter your email address" value="<%= user.email_address %> ">
                    </div>                   

                    <!-- Form Row-->
                    <div class="row gx-3 mb-3">
                        <!-- Form Group (phone number)-->
                        <div class="col-md-6">
                            <label class="small mb-1" for="inputLocation">Phone Number</label>
                            <input class="form-control" id="phoneNumber" type="tel" placeholder="Enter your phone number" value="<%= user.phone_number %> ">
                        </div>
                        <!-- Form Group (birthday)-->
                        <div class="col-md-6">
                            <label class="small mb-1" for="inputBirthday">Birthday</label>
                            <% let dateString = user.year_of_birth%> 
                            <%function getDate(dateString){%>
                                <%  let dateStr = dateString%>
                                <%let d=new Date(dateStr).toISOString()%>
                                <%let n=d.split("T")%>
                                <%let date=n[0]%>
                                <%return date%>
                                <%}%>                                
                            
                            <%function calculateAge(dob){%>
                               <% var dob = new Date(dob); %>                                 
                               <% var month_diff = Date.now() - dob.getTime();%>
                               <% var age_dt = new Date(month_diff);%>                                                         
                               <% var year = age_dt.getUTCFullYear(); %>                                                                    
                               <% var age = Math.abs(year - 1970); %>                                                                                              
                               <% return age;%>
                            <% } %>  
                            <% function getFormat(date){ %> 
                                <% let stringDateDivided=date.split("-") %> 
                                <%let message= stringDateDivided%> 
                                <% console.log(stringDateDivided) %> 
                                <% let d=parseInt(stringDateDivided[2]) %> 
                                <% let re=`${d}/${stringDateDivided[1]}/${stringDateDivided[0]}` %> 
                                <% return re%> 
                            <%  } %>                              
                            <% let ex1=getDate(dateString) %> 
                            <% let dob= getFormat(ex1)%> 
                            <input class="form-control" id="inputBirthday" name="year_of_birth" type="date" name="birthday" placeholder="Enter your birthday">
                            <input type="hidden" name="_csrf" id="_csrf" value="<%= csrfToken %>">
                            <input type="hidden" id="send" name="sent_number"/> 

                        </div>
                        
                        
                    </div>
                    <button type="submit" class="btn btn-primary">Update <%=user.first_name%>'s Account</button>
                    
                </form>
            </div>
        </div>
    </div>
    <div>        
    </div>
</div>
  </div>



<%- include('../partials/footer.ejs') %> 